/*! A fix for the iOS orientationchange zoom bug.
  Script by @scottjehl, rebound by @wilto.
  MIT / GPLv2 License.
  */
function naturalSort(e,t){var n=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,r=/(^[ ]*|[ ]*$)/g,i=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,s=/^0x[0-9a-f]+$/i,o=/^0/,u=e.toString().replace(r,"")||"",a=t.toString().replace(r,"")||"",f=u.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),l=a.replace(n,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),c=parseInt(u.match(s))||f.length!=1&&u.match(i)&&Date.parse(u),h=parseInt(a.match(s))||c&&a.match(i)&&Date.parse(a)||null;if(h){if(c<h)return-1;if(c>h)return 1}for(var p=0,d=Math.max(f.length,l.length);p<d;p++){oFxNcL=!(f[p]||"").match(o)&&parseFloat(f[p])||f[p]||0,oFyNcL=!(l[p]||"").match(o)&&parseFloat(l[p])||l[p]||0;if(isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;typeof oFxNcL!=typeof oFyNcL&&(oFxNcL+="",oFyNcL+="");if(oFxNcL<oFyNcL)return-1;if(oFxNcL>oFyNcL)return 1}return 0}(function(e){function h(){r.setAttribute("content",o),u=!0}function p(){r.setAttribute("content",s),u=!1}function d(t){c=t.accelerationIncludingGravity,a=Math.abs(c.x),f=Math.abs(c.y),l=Math.abs(c.z),(!e.orientation||e.orientation===180)&&(a>7||(l>6&&f<8||l<8&&f>6)&&a>5)?u&&p():u||h()}var t=navigator.userAgent;if(!(/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(t)&&t.indexOf("AppleWebKit")>-1))return;var n=e.document;if(!n.querySelector)return;var r=n.querySelector("meta[name=viewport]"),i=r&&r.getAttribute("content"),s=i+",maximum-scale=1",o=i+",maximum-scale=10",u=!0,a,f,l,c;if(!r)return;e.addEventListener("orientationchange",h,!1),e.addEventListener("devicemotion",d,!1)})(this),window.matchMedia=window.matchMedia||function(e,t){var n,r=e.documentElement,i=r.firstElementChild||r.firstChild,s=e.createElement("body"),o=e.createElement("div");return o.id="mq-test-1",o.style.cssText="position:absolute;top:-100em",s.style.background="none",s.appendChild(o),function(e){return o.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',r.insertBefore(s,i),n=o.offsetWidth==42,r.removeChild(s),{matches:n,media:e}}}(document),function(e){function S(){b(!0)}e.respond={},respond.update=function(){},respond.mediaQueriesSupported=e.matchMedia&&e.matchMedia("only all").matches;if(respond.mediaQueriesSupported)return;var t=e.document,n=t.documentElement,r=[],i=[],s=[],o={},u=30,a=t.getElementsByTagName("head")[0]||n,f=t.getElementsByTagName("base")[0],l=a.getElementsByTagName("link"),c=[],h=function(){var t=l,n=t.length,r=0,i,s,u,a;for(;r<n;r++)i=t[r],s=i.href,u=i.media,a=i.rel&&i.rel.toLowerCase()==="stylesheet",!!s&&a&&!o[s]&&(i.styleSheet&&i.styleSheet.rawCssText?(d(i.styleSheet.rawCssText,s,u),o[s]=!0):(!/^([a-zA-Z:]*\/\/)/.test(s)&&!f||s.replace(RegExp.$1,"").split("/")[0]===e.location.host)&&c.push({href:s,media:u}));p()},p=function(){if(c.length){var e=c.shift();w(e.href,function(t){d(t,e.href,e.media),o[e.href]=!0,p()})}},d=function(e,t,n){var s=e.match(/@media[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi),o=s&&s.length||0,t=t.substring(0,t.lastIndexOf("/")),u=function(e){return e.replace(/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,"$1"+t+"$2$3")},a=!o&&n,f=0,l,c,h,p,d;t.length&&(t+="/"),a&&(o=1);for(;f<o;f++){l=0,a?(c=n,i.push(u(e))):(c=s[f].match(/@media *([^\{]+)\{([\S\s]+?)$/)&&RegExp.$1,i.push(RegExp.$2&&u(RegExp.$2))),p=c.split(","),d=p.length;for(;l<d;l++)h=p[l],r.push({media:h.split("(")[0].match(/(only\s+)?([a-zA-Z]+)\s?/)&&RegExp.$2||"all",rules:i.length-1,hasquery:h.indexOf("(")>-1,minw:h.match(/\(min\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||""),maxw:h.match(/\(max\-width:[\s]*([\s]*[0-9\.]+)(px|em)[\s]*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||"")})}b()},v,m,g=function(){var e,r=t.createElement("div"),i=t.body,s=!1;return r.style.cssText="position:absolute;font-size:1em;width:1em",i||(i=s=t.createElement("body"),i.style.background="none"),i.appendChild(r),n.insertBefore(i,n.firstChild),e=r.offsetWidth,s?n.removeChild(i):i.removeChild(r),e=y=parseFloat(e),e},y,b=function(e){var o="clientWidth",f=n[o],c=t.compatMode==="CSS1Compat"&&f||t.body[o]||f,h={},p=l[l.length-1],d=(new Date).getTime();if(e&&v&&d-v<u){clearTimeout(m),m=setTimeout(b,u);return}v=d;for(var w in r){var E=r[w],S=E.minw,x=E.maxw,T=S===null,N=x===null,C="em";!S||(S=parseFloat(S)*(S.indexOf(C)>-1?y||g():1)),!x||(x=parseFloat(x)*(x.indexOf(C)>-1?y||g():1));if(!E.hasquery||(!T||!N)&&(T||c>=S)&&(N||c<=x))h[E.media]||(h[E.media]=[]),h[E.media].push(i[E.rules])}for(var w in s)s[w]&&s[w].parentNode===a&&a.removeChild(s[w]);for(var w in h){var L=t.createElement("style"),A=h[w].join("\n");L.type="text/css",L.media=w,a.insertBefore(L,p.nextSibling),L.styleSheet?L.styleSheet.cssText=A:L.appendChild(t.createTextNode(A)),s.push(L)}},w=function(e,t){var n=E();if(!n)return;n.open("GET",e,!0),n.onreadystatechange=function(){if(n.readyState!=4||n.status!=200&&n.status!=304)return;t(n.responseText)};if(n.readyState==4)return;n.send(null)},E=function(){var e=!1;try{e=new XMLHttpRequest}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return function(){return e}}();h(),respond.update=h,e.addEventListener?e.addEventListener("resize",S,!1):e.attachEvent&&e.attachEvent("onresize",S)}(this),function(e){"use strict";var t={};t.CookieChecker=function(){var t=e.cookie("allow-cookies"),n;t||(n=e("#cookies"),n.bind("click","a.confirm",function(t){t.preventDefault(),n.hide(),e.cookie("allow-cookies",!0,{expires:365,path:"/"})}),e("body").prepend(n.show()))},t.searchAsYouType=function(){var t,n,r,i,s,o=-1,u=[],a={16:null,27:function(){d(),t.blur()},37:null,38:function(e){m(),e.preventDefault(e)},39:null,40:function(e){v(),e.preventDefault()},9:function(e){e.shiftKey?m():v(),e.preventDefault()},13:function(e){e.preventDefault(),n.find("a.focused").trigger("click")}},f=function(o,u){t=e(o);if(t.size()==0)return;n=e('<div id="search-suggestions" class="suggestions" style="display:none;position:absolute;"></div>'),n.css({width:t.outerWidth()+"px"});var f=e("body");r=parseInt(f.css("paddingLeft"),10),i=parseInt(f.css("paddingTop"),10)+t.outerHeight(),s=e.extend({source:[],onShow:e.noop,onHide:e.noop},u||{}),typeof s.source=="function"&&(s.source=s.source.call(this)),t.bind("keydown.autocomplete",function(e){var t=a[e.keyCode.toString()];typeof t=="function"&&t.call(this,e)}).bind("keyup.autocomplete",function(e){if(typeof a[e.keyCode.toString()]!="undefined"){e.preventDefault();return}l(t.val())}).bind("focus.autocomplete",function(){e.trim(t.val())!==""&&p()}).bind("blur.autocomplete",function(){g(-1)}),e(window).bind("resize.autocomplete",y),n.appendTo("body")},l=function(t){var t=e.trim(t);t===""?(h([]),d()):t!==""&&(h(c(t)),n.is(":hidden")&&p())},c=function(t){var n=new RegExp("^"+t+"|\\s"+t,"i");return e.grep(s.source,function(e){return n.exec(e.name)!==null})},h=function(t){u=t,o=-1,u.length==0&&u.push(b());var r=["<ul>"];e.each(u,function(e,t){r.push('<li><a href="'+t.href+'">'+t.name+"</a></li>")}),r.push("</ul>"),n.html(r.join(""))},p=function(){y(),n.show(),e("#search").addClass("has-results"),e(document).bind("click.autocomplete",function(r){var i=n.get(0);r.target!==t.get(0)&&r.target!==i&&!e.contains(i,r.target)&&(d(),t.blur())}),s.onShow(t,n)},d=function(){n.hide(),e("#search").removeClass("has-results"),e(document).unbind("click.autocomplete"),s.onHide(t,n)},v=function(){var e=u.length;e>0&&o<e-1?g(o+1):o===e-1&&g(0)},m=function(){o!==-1?g(o-1):g(u.length-1)},g=function(e){n.find("li").removeClass("focused").filter(":nth-child("+(e+1)+")").addClass("focused"),o=e},y=function(){var e=t.offset();n.css({top:Math.round(e.top+i)+"px",left:Math.round(e.left+r)+"px"})},b=function(){return{name:"No matches found",id:null}};return f}(),t.NavigationToggler=function(t){var n=e(t),r=!1,i,s=function(){if(r)return;var t=e("#site-navigation");i=t.clone(),i.attr("id","site-top-navigation").css({visibility:"hidden"}),i.append('<a href="#" class="close"><span>St√§ng meny</span></a>'),i.find("a.close").bind("click",a),e("body").append(i);var n=document.createElement("style");n.id="navigation-styles",n.type="text/css",n.innerHTML=o(i),document.getElementsByTagName("head")[0].appendChild(n),r=!0},o=function(e){var t=e.outerHeight(),n="#site-top-navigation { margin-top: -"+t+"px; }";return n+="#site-top-navigation.inactive { margin-top: -"+t+"px; }",n},u=function(){if(!r){s();return}var e=document.getElementById("navigation-styles");e.innerHTML=o(e)},a=function(e){e.preventDefault(),i.addClass("inactive").removeClass("active")},f=function(e){e.preventDefault(),i.css("visibility","visible"),i.addClass("active").removeClass("inactive")};n.bind("click",f),e(document).bind("resize",function(){setTimeout(u,200)}),s()},t.focusAndCopy=function(t){var n=function(){var e=this;window.setTimeout(function(){e.select()},5)};e(t).bind("focus",n).bind("click",n)},t.voting=function(){e("div.voting").each(function(){var t=e(this),n=t.find("div.votable"),r=t.find("div.results");if(r.size()==0)return;r.hide(),n.append('<a href="#" class="show-results toggler">'+n.data("show-results-copy")+"</a>"),r.append('<a href="#" class="show-votable toggler">'+r.data("show-votable-copy")+"</a>"),t.delegate("button, a.show-results","click",function(e){console.log(e),e.preventDefault(),n.hide(),r.show()}),t.delegate("a.show-votable","click",function(e){e.preventDefault(),r.hide(),n.show()})})},e(document).ready(function(){t.NavigationToggler("#skip-to-navigation"),t.CookieChecker(),t.searchAsYouType("#topics-search",{source:function(){var t=e.map(e("#topics a"),function(t){return{name:e(t).text(),href:t.href}});return t.sort(function(e,t){return naturalSort(e.name,t.name)})},onShow:function(e){e.parent().addClass("active-suggestions")},onHide:function(e){e.parent().removeClass("active-suggestions")}}),e("section.tabbed").tabs(),e("#conversation-form").hide(),e("#go-to-form").bind("click",function(t){t.preventDefault();var n=e("#conversation-form");n.is(":visible")?e("#conversation-form").slideUp():e("#conversation-form").slideDown()}),t.focusAndCopy("input.share"),t.voting()})}(jQuery);