(function(e){function t(){e("div.voting").each(function(){var t=e(this),n=t.find("div.votable"),r=t.find("div.poll-results");if(r.size()==0)return;r.hide(),n.append('<a href="#" class="show-results toggler">'+n.data("show-results-copy")+"</a>"),r.append('<a href="#" class="show-votable toggler">'+r.data("show-votable-copy")+"</a>"),t.delegate("button, a.show-results","click",function(e){e.preventDefault(),n.hide(),r.show()}),t.delegate("a.show-votable","click",function(e){e.preventDefault(),r.hide(),n.show()})})}function n(t){t.preventDefault();var n=e(t.liveFired),r=n.parents("div.speech-bubble"),i=r.siblings(".article-section.local");i.size()!==0&&(r.hide(),i.show())}e(document).ready(function(){t(),e("div.position-me").delegate("span.choose","click",function(t){t.preventDefault();var r=e(t.liveFired);r.hide(),r.siblings("div.localities").show().delegate("form","submit",n)}).delegate("a.action","click",n).each(function(){var t=e(this).parents("div.speech-bubble"),n=t.siblings(".article-section.local");n.hide()}),Mp.searchAsYouType("#main-search",{limit:25,inlined:!0,source:function(){var t=this,n=this.element.data("source");e.getJSON(n,function(e){t.source=e})},itemTemplate:function(e,t){var n=['<li><a href="'+e.href+'">'],r=e.name,i=[],s=t.split(" ");for(var o=0,u=s.length;o<u;o++){var a=r.match(new RegExp(s[o],"gi"));a&&(i=i.concat(a))}if(i.length>0)for(var o=0,u=i.length;o<u;o++)r=r.replace(i[o],"<em>"+i[o]+"</em>");return n.push('<span class="name">'),n.push(r),n.push("</span>"),n.push('<span class="category">'),n.push(e.category),n.push("</span>"),n.push("</a></li>"),n.join("")},onSetup:function(){this.container.addClass("main-search")},onShow:function(){this.element.addClass("has-suggestions")},onHide:function(){this.element.removeClass("has-suggestions")},sortFunction:function(e,t){return e.score!==t.score?e.score<t.score?1:-1:this.defaultSortFunction(e,t)}})})})(jQuery);